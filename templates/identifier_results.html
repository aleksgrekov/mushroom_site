{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="text-center mb-5">
            <h1 class="display-4 mb-3">üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è</h1>
            <div class="alert alert-info">
                <strong>–û—Ç–≤–µ—á–µ–Ω–æ –≤–æ–ø—Ä–æ—Å–æ–≤: {{ answered_questions }}/6</strong>
                {% if answered_questions == 0 %}
                <p class="mb-0">–ü–æ–∫–∞–∑–∞–Ω—ã –≤—Å–µ –≥—Ä–∏–±—ã. –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è!</p>
                {% endif %}
            </div>
            <a href="{% url 'interactive_identifier' %}" class="btn btn-outline-primary">
                üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
            </a>
        </div>
        
        {% if results %}
            <p class="lead">–ù–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≥—Ä–∏–±–æ–≤: <strong>{{ results|length }}</strong></p>
            
            {% for result in results %}
            <div class="card shadow-lg mb-4">
                <div class="card-header {% if result.mushroom.edibility == 'edible' %}bg-success{% elif result.mushroom.edibility == 'poisonous' or result.mushroom.edibility == 'deadly' %}bg-danger{% else %}bg-warning{% endif %} text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            {% if result.mushroom.edibility == 'edible' %}üçÑ{% elif result.mushroom.edibility == 'poisonous' or result.mushroom.edibility == 'deadly' %}‚ò†Ô∏è{% else %}‚ö†Ô∏è{% endif %}
                            {{ result.mushroom.russian_name }}
                        </h4>
                        <div>
                            <span class="badge bg-light text-dark">
                                –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ: {{ result.match_percentage }}%
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            {% if result.mushroom.photo %}
                            <img src="{{ result.mushroom.photo.url }}" class="img-fluid rounded" alt="{{ result.mushroom.russian_name }}">
                            {% else %}
                            <div class="bg-light rounded d-flex align-items-center justify-content-center" style="height: 200px;">
                                <span class="text-muted">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</span>
                            </div>
                            {% endif %}
                        </div>
                        <div class="col-md-8">
                            <h5 class="text-muted">{{ result.mushroom.latin_name }}</h5>
                            <div class="mb-3">
                                <span class="badge {% if result.mushroom.edibility == 'edible' %}bg-success{% elif result.mushroom.edibility == 'poisonous' or result.mushroom.edibility == 'deadly' %}bg-danger{% else %}bg-warning{% endif %} fs-6">
                                    {{ result.mushroom.get_edibility_display }}
                                </span>
                            </div>
                            <p class="card-text">{{ result.mushroom.description|linebreaks }}</p>
                            
                            {% if result.mushroom.key_characteristics %}
                            <p><strong>–ö–ª—é—á–µ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</strong> {{ result.mushroom.key_characteristics }}</p>
                            {% endif %}
                            
                            {% if result.mushroom.habitat %}
                            <p><strong>–ú–µ—Å—Ç–æ –æ–±–∏—Ç–∞–Ω–∏—è:</strong> {{ result.mushroom.habitat }}</p>
                            {% endif %}
                        </div>
                    </div>
                    
                    {% if result.lookalikes %}
                    <div class="mt-4">
                        <h5 class="text-danger mb-3">‚ö†Ô∏è –û—Å—Ç–æ—Ä–æ–∂–Ω–æ! –î–≤–æ–π–Ω–∏–∫–∏:</h5>
                        {% for lookalike in result.lookalikes %}
                        <div class="alert {% if lookalike.danger_level == 'deadly' %}alert-danger{% elif lookalike.danger_level == 'high' %}alert-warning{% else %}alert-info{% endif %}">
                            <h6>
                                {{ lookalike.lookalike.russian_name }} 
                                <small class="text-muted">({{ lookalike.lookalike.latin_name }})</small>
                                - <span class="badge {% if lookalike.lookalike.edibility == 'poisonous' or lookalike.lookalike.edibility == 'deadly' %}bg-danger{% else %}bg-warning{% endif %}">
                                    {{ lookalike.lookalike.get_edibility_display }}
                                </span>
                            </h6>
                            <p class="mb-1"><strong>–ö–ª—é—á–µ–≤—ã–µ –æ—Ç–ª–∏—á–∏—è:</strong> {{ lookalike.differences }}</p>
                            <p class="mb-0"><strong>–í–∏–∑—É–∞–ª—å–Ω—ã–µ –æ—Ç–ª–∏—á–∏—è:</strong> {{ lookalike.visual_differences }}</p>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
            
        {% else %}
            <div class="card shadow-lg">
                <div class="card-body text-center py-5">
                    <h3 class="text-muted">üòï –ì—Ä–∏–±—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                    <p class="lead">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞.</p>
                    <a href="{% url 'interactive_identifier' %}" class="btn btn-primary btn-lg">
                        üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}